<!DOCTYPE html>
<html>
<head>
    <title>Evil Twin Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1e1e1e; color: white; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #444; }
        button { padding: 10px 15px; margin: 5px; background: #3498db; color: white; border: none; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; background: #2c3e50; }
        .success { background: #27ae60; }
        .error { background: #e74c3c; }
    </style>
</head>
<body>
    <h1>Evil Twin Detection Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Basic Functionality</h2>
        <button onclick="testBasicFunctionality()">Test Basic Evil Twin Detection</button>
        <div id="test1-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Whitelist Management</h2>
        <button onclick="testWhitelistManagement()">Test Whitelist Add/Remove</button>
        <div id="test2-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Real-time Detection</h2>
        <button onclick="testRealTimeDetection()">Test Real-time Evil Twin Simulation</button>
        <div id="test3-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Live Page Test</h2>
        <button onclick="openLivePage()">Open Live Deauth & Evil Twin Page</button>
        <div id="test4-result" class="result"></div>
    </div>

    <script>
        function testBasicFunctionality() {
            const result = document.getElementById('test1-result');
            result.innerHTML = 'Testing basic Evil Twin detection logic...';
            
            // Simulate the Evil Twin detection logic
            const apList = {};
            const whitelistedBSSIDs = new Set(['dc:8d:8a:b9:13:36', '20:9a:7d:5c:83:a0']);
            
            // Add test data
            const ssid = 'TestNetwork';
            apList[ssid] = [
                { bssid: 'aa:bb:cc:dd:ee:ff', timestamp: Date.now() - 60000 },
                { bssid: '11:22:33:44:55:66', timestamp: Date.now() }
            ];
            
            // Test risk analysis
            function analyzeEvilTwinRisk(ssid, bssidData) {
                if (bssidData.length < 2) return false;
                
                const hasNonWhitelisted = bssidData.some(entry => 
                    !whitelistedBSSIDs.has(entry.bssid.toLowerCase())
                );
                
                return hasNonWhitelisted && bssidData.length > 1;
            }
            
            const isEvilTwin = analyzeEvilTwinRisk(ssid, apList[ssid]);
            
            if (isEvilTwin) {
                result.innerHTML = '<span class="success">✓ Evil Twin detection logic working correctly!</span>';
                result.innerHTML += '<br>Detected suspicious BSSID: 11:22:33:44:55:66';
            } else {
                result.innerHTML = '<span class="error">✗ Evil Twin detection failed</span>';
            }
        }
        
        function testWhitelistManagement() {
            const result = document.getElementById('test2-result');
            result.innerHTML = 'Testing whitelist management...';
            
            const whitelistedBSSIDs = new Set();
            
            // Test adding to whitelist
            whitelistedBSSIDs.add('aa:bb:cc:dd:ee:ff');
            whitelistedBSSIDs.add('11:22:33:44:55:66');
            
            if (whitelistedBSSIDs.size === 2) {
                result.innerHTML = '<span class="success">✓ Whitelist add functionality working!</span>';
                result.innerHTML += '<br>Whitelisted BSSIDs: ' + Array.from(whitelistedBSSIDs).join(', ');
                
                // Test removing from whitelist
                whitelistedBSSIDs.delete('11:22:33:44:55:66');
                
                if (whitelistedBSSIDs.size === 1) {
                    result.innerHTML += '<br><span class="success">✓ Whitelist remove functionality working!</span>';
                } else {
                    result.innerHTML += '<br><span class="error">✗ Whitelist remove failed</span>';
                }
            } else {
                result.innerHTML = '<span class="error">✗ Whitelist add functionality failed</span>';
            }
        }
        
        function testRealTimeDetection() {
            const result = document.getElementById('test3-result');
            result.innerHTML = 'Testing real-time detection simulation...';
            
            let detectionCount = 0;
            
            function simulateEvilTwinDetection() {
                const testSSIDs = ['WiFi_Network_1', 'Corporate_WiFi', 'Home_Router'];
                
                // 30% chance of detection for testing
                if (Math.random() < 0.3) {
                    detectionCount++;
                    const ssid = testSSIDs[Math.floor(Math.random() * testSSIDs.length)];
                    const suspiciousBSSID = generateRandomBSSID();
                    
                    result.innerHTML += `<br>Evil Twin detected on ${ssid}: ${suspiciousBSSID}`;
                }
            }
            
            function generateRandomBSSID() {
                const hex = '0123456789ABCDEF';
                let bssid = '';
                for (let i = 0; i < 6; i++) {
                    if (i > 0) bssid += ':';
                    bssid += hex[Math.floor(Math.random() * 16)];
                    bssid += hex[Math.floor(Math.random() * 16)];
                }
                return bssid;
            }
            
            // Run simulation 5 times
            for (let i = 0; i < 5; i++) {
                setTimeout(simulateEvilTwinDetection, i * 1000);
            }
            
            setTimeout(() => {
                if (detectionCount > 0) {
                    result.innerHTML += `<br><span class="success">✓ Real-time detection working! Detected ${detectionCount} evil twins</span>`;
                } else {
                    result.innerHTML += '<br><span class="success">✓ Real-time detection running (no detections this time)</span>';
                }
            }, 6000);
        }
        
        function openLivePage() {
            const result = document.getElementById('test4-result');
            result.innerHTML = 'Opening live page...';
            
            // Test if the server is running
            fetch('http://127.0.0.1:5053/api/ping')
                .then(response => response.json())
                .then(data => {
                    result.innerHTML = '<span class="success">✓ Server is running!</span>';
                    result.innerHTML += `<br>Server status: ${data.status}`;
                    result.innerHTML += '<br><a href="http://127.0.0.1:5053/deauth.html" target="_blank" style="color: #3498db;">Open Deauth & Evil Twin Monitor</a>';
                })
                .catch(error => {
                    result.innerHTML = '<span class="error">✗ Server not responding</span>';
                    result.innerHTML += '<br>Error: ' + error.message;
                });
        }
    </script>
</body>
</html>
