<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelist Functionality Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #ecf0f1;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #2c3e50;
            border-radius: 8px;
        }
        .whitelisted-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background-color: rgba(30, 30, 30, 0.5);
            border-radius: 4px;
        }
        .bssid-cell {
            font-family: monospace;
            background-color: rgba(52, 73, 94, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }
        .remove-whitelist {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
        }
        .remove-whitelist:hover {
            background-color: #c0392b;
        }
        .test-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background-color: #2980b9;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background-color: #34495e;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Evil Twin Whitelist Functionality Test</h1>
        
        <div class="status">
            <h3>Test Instructions:</h3>
            <ol>
                <li>Click "Initialize Whitelist" to load the whitelist functionality</li>
                <li>Try removing a BSSID - you should see a confirmation dialog</li>
                <li>Cancel the first time to test the confirmation works</li>
                <li>Remove a BSSID by confirming the dialog</li>
                <li>Refresh the page and check that removed items don't reappear</li>
            </ol>
        </div>

        <div>
            <button class="test-button" onclick="initializeTest()">Initialize Whitelist</button>
            <button class="test-button" onclick="addTestBSSID()">Add Test BSSID</button>
            <button class="test-button" onclick="clearAllWhitelist()">Clear All (Test)</button>
            <button class="test-button" onclick="showWhitelistStatus()">Show Status</button>
        </div>

        <div class="whitelisted-networks">
            <h4><i class="fas fa-shield-check"></i> Whitelisted BSSIDs (<span id="whitelist-count">0</span>)</h4>
            <div id="whitelist-container">
                <!-- Whitelisted BSSIDs will be populated here -->
            </div>
        </div>

        <div class="status" id="test-status">
            Status: Ready for testing
        </div>
    </div>

    <script>
        // Copy the relevant functions from deauth.js for testing
        let whitelistedBSSIDs = new Set();

        function loadDefaultWhitelist() {
            const defaultBSSIDs = [
                "dc:8d:8a:b9:13:36",
                "20:9a:7d:5c:83:a0", 
                "cc:d4:2e:88:77:b6"
            ];
            
            defaultBSSIDs.forEach(bssid => whitelistedBSSIDs.add(bssid));
            saveWhitelistToStorage();
        }

        function saveWhitelistToStorage() {
            try {
                const whitelistArray = Array.from(whitelistedBSSIDs);
                localStorage.setItem('evilTwinWhitelist', JSON.stringify(whitelistArray));
                console.log('Saved to localStorage:', whitelistArray);
            } catch (e) {
                console.log("Error saving whitelist:", e);
            }
        }

        function initEvilTwinDetection() {
            console.log("Evil Twin Detection initialized");
            
            const savedWhitelist = localStorage.getItem('evilTwinWhitelist');
            if (savedWhitelist) {
                try {
                    const whitelistArray = JSON.parse(savedWhitelist);
                    whitelistArray.forEach(bssid => whitelistedBSSIDs.add(bssid));
                    console.log("Loaded whitelist from localStorage:", whitelistArray);
                } catch (e) {
                    console.log("Error loading saved whitelist:", e);
                    loadDefaultWhitelist();
                }
            } else {
                loadDefaultWhitelist();
                console.log("No saved whitelist found, loading defaults");
            }
            
            console.log("Whitelisted BSSIDs:", Array.from(whitelistedBSSIDs));
        }

        function updateWhitelistDisplay() {
            const container = document.getElementById('whitelist-container');
            const countElement = document.getElementById('whitelist-count');
            
            container.innerHTML = '';
            countElement.textContent = whitelistedBSSIDs.size;
            
            Array.from(whitelistedBSSIDs).forEach(bssid => {
                const item = document.createElement('div');
                item.className = 'whitelisted-item';
                item.innerHTML = `
                    <code class="bssid-cell">${bssid.toUpperCase()}</code>
                    <button class="remove-whitelist" onclick="removeFromWhitelist('${bssid}')">
                        <i class="fas fa-times"></i> Remove
                    </button>
                `;
                container.appendChild(item);
            });
        }

        function removeFromWhitelist(bssid) {
            // Show confirmation dialog
            const isConfirmed = confirm(`Are you sure you want to remove BSSID "${bssid.toUpperCase()}" from the whitelist?\n\nThis action will permanently remove it from your trusted devices list.`);
            
            if (!isConfirmed) {
                console.log(`User cancelled removal of ${bssid} from whitelist`);
                updateTestStatus(`❌ User cancelled removal of ${bssid}`, 'info');
                return; // User cancelled, don't remove
            }
            
            // User confirmed, proceed with removal
            whitelistedBSSIDs.delete(bssid.toLowerCase());
            saveWhitelistToStorage();
            updateWhitelistDisplay();
            updateTestStatus(`✅ BSSID ${bssid} permanently removed from whitelist`, 'success');
            console.log(`Permanently removed ${bssid} from whitelist`);
        }

        // Test functions
        function initializeTest() {
            initEvilTwinDetection();
            updateWhitelistDisplay();
            updateTestStatus('✅ Whitelist initialized successfully', 'success');
        }

        function addTestBSSID() {
            const testBSSID = '11:22:33:44:55:66';
            whitelistedBSSIDs.add(testBSSID);
            saveWhitelistToStorage();
            updateWhitelistDisplay();
            updateTestStatus(`✅ Added test BSSID: ${testBSSID}`, 'success');
        }

        function clearAllWhitelist() {
            if (confirm('Clear all whitelisted BSSIDs? This is for testing purposes.')) {
                whitelistedBSSIDs.clear();
                saveWhitelistToStorage();
                updateWhitelistDisplay();
                updateTestStatus('✅ All BSSIDs cleared', 'success');
            }
        }

        function showWhitelistStatus() {
            const saved = localStorage.getItem('evilTwinWhitelist');
            const current = Array.from(whitelistedBSSIDs);
            updateTestStatus(`Current: ${current.length} BSSIDs | localStorage: ${saved ? JSON.parse(saved).length : 0} BSSIDs`, 'info');
        }

        function updateTestStatus(message, type) {
            const statusElement = document.getElementById('test-status');
            statusElement.innerHTML = `Status: ${message}`;
            statusElement.style.backgroundColor = type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#34495e';
        }

        // Auto-initialize on page load
        window.onload = function() {
            initializeTest();
        };
    </script>
</body>
</html>
